<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>User Authentication using JWT (JSON Web Token) in Node.js (Express Framework)</title>
  <meta name="description" content="Here we will learn how to implement user authentication using JWT(JSON Web Token) strategy. What we are going to use here:">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/2016/05/22/user-authentication-using-JWT-(JSON-Web-Token)-in-Node.js-(express=framework)/">
  <link rel="alternate" type="application/rss+xml" title="Soni Pandey" href="/feed.xml">

  <link href="https://fonts.googleapis.com/css?family=EB+Garamond|Quicksand" rel="stylesheet">

  
</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" href="/">
      
        <img src="https://1.gravatar.com/avatar/40870a65d7d072a12b06603e346fc3dd?size=40" alt=""/>
      
      Soni Pandey
    </a>
    <nav class="site-nav">
          
            <a href="https://github.com/pandeysoni"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">pandeysoni</span></a>

          

          
            <a href="https://twitter.com/sonipandey1"><span class="icon icon--twitter"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">sonipandey1</span></a>

          
          
          
            <a href="https://www.linkedin.com/in/pandeysoni"><span class="icon icon--linkedin"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg></span><span class="username"> pandeysoni</span></a>
          
         
    </nav>
   <!--  
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
          
            
            
          
            
            
          
            
            
          
        </div>
      </nav>
     -->
  </div>
</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <p>
  <a href="/">&laquo; All posts</a>
</p>

<article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">User Authentication using JWT (JSON Web Token) in Node.js (Express Framework)</h1>
    <p class="post-meta">
      <time datetime="2016-05-22T00:00:00+05:30" itemprop="datePublished">
        
        May 22, 2016
      </time>
      </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>Here we will learn how to implement user authentication using JWT(JSON Web Token) strategy. What we are going to use here:</p>

<ul>
  <li>Node.js</li>
  <li>Express Framework</li>
  <li>Mongodb</li>
  <li>JWT</li>
</ul>

<p>I assume, you all are aware with Node.js, Express Framework and Mongodb. If not, please have a look on my previous posts:</p>

<ol>
  <li><a href="http://thepandeysoni.org/2016/05/02/node.js-single-file-application-using-express-framework/">Node.js Single File Application using Express Framework.</a></li>
  <li><a href="http://thepandeysoni.org/2016/05/04/CRUD-operations-in-node.js-application-(expresss=framework)-using-mongodb/">CRUD Operations in Node.js Application (Expresss Framework) using mongodb.</a></li>
</ol>

<p>These articles will atleast give you an overview about it.</p>

<p>What is <strong><em>JWT (JSON Web Token)</em></strong>?
A JSON Web Token, or JWT, is used to send information that can be verified and trusted by means of a digital signature. It comprises a compact and URL-safe JSON object, which is cryptographically signed to verify its authenticity, and which can also be encrypted if the payload contains sensitive information. Because of it’s compact structure, JWT is usually used in HTTP Authorization headers or URL query parameters.
Here we will learn how to implement token based user authentication.</p>
<ol>
  <li>Register new user.</li>
  <li>One email address can be registered only once.</li>
  <li>After registration a verification link is send to user’s email address.</li>
  <li>Verify account by clicking on link send to user’semail address and on successful verification user will be redirected to login page.</li>
  <li>If you are not verified your account after creation, you will not be allowed to land to dashboard after success login.</li>
  <li>User can resend password to registered email address in case user forget.
Project Structure will be like this:</li>
</ol>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="o">+</span> <span class="nx">server</span>
 <span class="o">+</span> <span class="nx">user</span><span class="p">(</span><span class="nx">there</span> <span class="nx">can</span> <span class="nx">be</span> <span class="nx">multilple</span> <span class="nx">other</span> <span class="nx">modules</span> <span class="nx">like</span> <span class="nx">user</span><span class="p">)</span>
    <span class="o">+</span> <span class="nx">user</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">controller</span><span class="p">.</span><span class="nx">js</span>
    <span class="o">+</span> <span class="nx">user</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">js</span>
    <span class="o">+</span> <span class="nx">user</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">js</span>
 <span class="o">+</span> <span class="nx">config</span>
    <span class="o">+</span> <span class="nx">config</span><span class="p">.</span><span class="nx">js</span>
    <span class="o">+</span> <span class="nx">db</span><span class="p">.</span><span class="nx">js</span>
 <span class="o">+</span> <span class="nx">routes</span><span class="p">.</span><span class="nx">js</span>
<span class="o">+</span> <span class="nx">server</span><span class="p">.</span><span class="nx">js</span>
<span class="o">+</span> <span class="kr">package</span><span class="p">.</span><span class="nx">json</span>
<span class="o">+</span> <span class="nx">README</span><span class="p">.</span><span class="nx">md</span>
</code></pre>
</div>
<p>You can also have a look to complete <a href="http://thepandeysoni.org/2016/05/07/CRUD-Operation-with-UI-integration-(Angular.js)/">MEAN Structure</a>.</p>

<p><strong>1. Setting up Server using Express Framework</strong></p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">Routes</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./server/routes'</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./server/config/config'</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">bodyParser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'body-parser'</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./server/config/db'</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'path'</span><span class="p">)</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nx">urlencoded</span><span class="p">({</span> <span class="na">extended</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}));</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'client/'</span><span class="p">)));</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'*'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">sendFile</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s1">'client/index.html'</span><span class="p">));</span> <span class="c1">// load the single view file (angular will handle the page changes on the front-end)</span>
<span class="p">});</span>
<span class="cm">/** load routes*/</span>

<span class="nx">require</span><span class="p">(</span><span class="s1">'./server/routes'</span><span class="p">)(</span><span class="nx">app</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">port</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">port</span><span class="p">;</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="nx">port</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'App started on port '</span> <span class="o">+</span> <span class="nx">port</span><span class="p">);</span>
</code></pre>
</div>
<p>First of all, we required all the module dependencies. After that we used middleware instances body-parser, cookie-parser and express-session. We used Mongodb to store database. You can see we loaded db file, so our connection will established, when we will start our server.</p>
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="err">‘</span><span class="p">.</span><span class="o">/</span><span class="nx">server</span><span class="o">/</span><span class="nx">config</span><span class="o">/</span><span class="nx">db</span><span class="err">’</span><span class="p">)</span>
</code></pre>
</div>
<p><strong>2. Setting up Database connection using Mongoose</strong></p>
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">Mongoose</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'mongoose'</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./config'</span><span class="p">);</span>

<span class="nx">Mongoose</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">db</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="nx">Mongoose</span><span class="p">.</span><span class="nx">connection</span><span class="p">;</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'error'</span><span class="p">,</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">console</span><span class="p">,</span> <span class="s1">'connection error'</span><span class="p">));</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">once</span><span class="p">(</span><span class="s1">'open'</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">callback</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Connection with database succeeded."</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">db</span> <span class="o">=</span> <span class="nx">db</span><span class="p">;</span>
</code></pre>
</div>
<p><strong>3. Setting up JWT</strong></p>
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">npm</span> <span class="nx">install</span> <span class="o">--</span><span class="nx">save</span> <span class="nx">jsonwebtoken</span>
</code></pre>
</div>
<p><strong><em>Register new user</em></strong>: We will check that enetered email id is unique or not. If email unique then we will save entry and send verification link using nodemailer.</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">exports</span><span class="p">.</span><span class="nx">create</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">password</span> <span class="o">=</span> <span class="nx">Common</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">password</span><span class="p">);</span>
  <span class="nx">User</span><span class="p">.</span><span class="nx">saveUser</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">tokenData</span> <span class="o">=</span> <span class="p">{</span>
              <span class="na">username</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
              <span class="na">id</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">_id</span>
          <span class="p">}</span>
          <span class="nx">Common</span><span class="p">.</span><span class="nx">sentMailVerificationLink</span><span class="p">(</span><span class="nx">user</span><span class="p">,</span><span class="nx">Jwt</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">tokenData</span><span class="p">,</span> <span class="nx">privateKey</span><span class="p">));</span>
          <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">Boom</span><span class="p">.</span><span class="nx">forbidden</span><span class="p">(</span><span class="s2">"Please confirm your email id by clicking on link in email"</span><span class="p">));</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="mi">11000</span> <span class="o">===</span> <span class="nx">err</span><span class="p">.</span><span class="nx">code</span> <span class="o">||</span> <span class="mi">11001</span> <span class="o">===</span> <span class="nx">err</span><span class="p">.</span><span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">Boom</span><span class="p">.</span><span class="nx">forbidden</span><span class="p">(</span><span class="s2">"please provide another user email"</span><span class="p">));</span>
          <span class="p">}</span> <span class="k">else</span><span class="p">{</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">Boom</span><span class="p">.</span><span class="nx">forbidden</span><span class="p">(</span><span class="nx">err</span><span class="p">));</span> <span class="c1">// HTTP 403</span>
          <span class="p">}</span>
      <span class="p">}</span>
  <span class="p">})</span>
<span class="p">}</span>
</code></pre>
</div>
<p>saveUser function is defined in model as a <a href="">statics function</a> and We used ‘aes-256-ctr’ algorithm to encrypt and decrypt password.</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span>  <span class="nx">algorithm</span> <span class="o">=</span> <span class="s1">'aes-256-ctr'</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">privateKey</span> <span class="o">=</span> <span class="s1">'37LvDSm4XvjYOh9Y'</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">decrypt</span><span class="p">(</span><span class="nx">password</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">decipher</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">createDecipher</span><span class="p">(</span><span class="nx">algorithm</span><span class="p">,</span> <span class="nx">privateKey</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">dec</span> <span class="o">=</span> <span class="nx">decipher</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">password</span><span class="p">,</span> <span class="s1">'hex'</span><span class="p">,</span> <span class="s1">'utf8'</span><span class="p">);</span>
    <span class="nx">dec</span> <span class="o">+=</span> <span class="nx">decipher</span><span class="p">.</span><span class="kr">final</span><span class="p">(</span><span class="s1">'utf8'</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">dec</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// method to encrypt data(password)</span>
<span class="kd">function</span> <span class="nx">encrypt</span><span class="p">(</span><span class="nx">password</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">cipher</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">createCipher</span><span class="p">(</span><span class="nx">algorithm</span><span class="p">,</span> <span class="nx">privateKey</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">crypted</span> <span class="o">=</span> <span class="nx">cipher</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">password</span><span class="p">,</span> <span class="s1">'utf8'</span><span class="p">,</span> <span class="s1">'hex'</span><span class="p">);</span>
    <span class="nx">crypted</span> <span class="o">+=</span> <span class="nx">cipher</span><span class="p">.</span><span class="kr">final</span><span class="p">(</span><span class="s1">'hex'</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">crypted</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>
<p><strong><em>Verify New User</em></strong>: When new user register, that user need to verify link, otherwise user will not able to login.<br />
<strong><em>Login User</em></strong>:</p>
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">exports</span><span class="p">.</span><span class="nx">login</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="nx">User</span><span class="p">.</span><span class="nx">findUser</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">user</span> <span class="o">===</span> <span class="kc">null</span><span class="p">){</span>
              <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">Boom</span><span class="p">.</span><span class="nx">forbidden</span><span class="p">(</span><span class="s2">"invalid username or password"</span><span class="p">));</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">password</span> <span class="o">===</span> <span class="nx">Common</span><span class="p">.</span><span class="nx">decrypt</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">password</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">.</span><span class="nx">isVerified</span><span class="p">){</span>
                  <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">Boom</span><span class="p">.</span><span class="nx">forbidden</span><span class="p">(</span><span class="s2">"Your email address is not verified. please verify your email address to proceed"</span><span class="p">));</span>
                <span class="p">}</span>
                <span class="k">else</span><span class="p">{</span> 
                  <span class="kd">var</span> <span class="nx">tokenData</span> <span class="o">=</span> <span class="p">{</span>
                      <span class="na">username</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
                      <span class="na">scope</span><span class="p">:</span> <span class="p">[</span><span class="nx">user</span><span class="p">.</span><span class="nx">scope</span><span class="p">],</span>
                      <span class="na">id</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">_id</span>
                  <span class="p">};</span>
                  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">{</span>
                      <span class="na">username</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
                      <span class="na">scope</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">scope</span><span class="p">,</span>
                      <span class="na">token</span><span class="p">:</span> <span class="nx">Jwt</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">tokenData</span><span class="p">,</span> <span class="nx">privateKey</span><span class="p">)</span>
                  <span class="p">};</span>

                  <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span><span class="p">{</span>
              <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">Boom</span><span class="p">.</span><span class="nx">forbidden</span><span class="p">(</span><span class="s2">"invalid username or password"</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="mi">11000</span> <span class="o">===</span> <span class="nx">err</span><span class="p">.</span><span class="nx">code</span> <span class="o">||</span> <span class="mi">11001</span> <span class="o">===</span> <span class="nx">err</span><span class="p">.</span><span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">Boom</span><span class="p">.</span><span class="nx">forbidden</span><span class="p">(</span><span class="s2">"please provide another user email"</span><span class="p">));</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
                    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">Boom</span><span class="p">.</span><span class="nx">badImplementation</span><span class="p">(</span><span class="nx">err</span><span class="p">));</span>
            <span class="p">}</span> 
        <span class="p">}</span>
    <span class="p">})</span>
<span class="p">}</span>
</code></pre>
</div>
<p>Initially, we find user in our database, once user found in database, we decrypted entered password and matched with found user’s password and after successful match, we generate one token.<br />
<strong><em>Forgot Password</em></strong>: In this case, we are using one package randomstring. install <strong><em>randomstring</em></strong> package:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">npm</span> <span class="nx">install</span> <span class="o">--</span> <span class="nx">save</span> <span class="nx">randomstring</span>
</code></pre>
</div>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">randomstring</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"randomstring"</span><span class="p">)</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">forgotPassword</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">random</span> <span class="o">=</span> <span class="nx">Common</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">(</span><span class="nx">randomstring</span><span class="p">.</span><span class="nx">generate</span><span class="p">({</span><span class="na">length</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="na">charset</span><span class="p">:</span> <span class="s1">'alphabetic'</span><span class="p">}));</span>
    <span class="nx">User</span><span class="p">.</span><span class="nx">findUserUpdate</span><span class="p">({</span><span class="na">username</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">username</span><span class="p">},</span> <span class="p">{</span><span class="na">password</span><span class="p">:</span> <span class="nx">random</span><span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">user</span> <span class="o">===</span> <span class="kc">null</span><span class="p">){</span>
                <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">Boom</span><span class="p">.</span><span class="nx">forbidden</span><span class="p">(</span><span class="s2">"invalid username"</span><span class="p">));</span>
            <span class="p">}</span>
            <span class="k">else</span><span class="p">{</span>
                <span class="nx">Common</span><span class="p">.</span><span class="nx">sentMailForgotPassword</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
                <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">"password is send to registered email id"</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>       
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">Boom</span><span class="p">.</span><span class="nx">badImplementation</span><span class="p">(</span><span class="nx">err</span><span class="p">));</span>
         <span class="p">}</span>
    <span class="p">})</span>
<span class="p">}</span>
</code></pre>
</div>
<p>Here, we are generating random password and updating that password, so that user can login with the random generated password.</p>

<p>Feel free to clone the full code for this post to see the full picture of how everything works together and customize it for your own needs. Have a look to repository for complete working code.
<a href="https://github.com/pandeysoni/User-Authentication-using-JWT-JSON-Web-Token-in-Node.js-Express">source code on github</a> 
You can reach out to me for any doubt and suggestions. Please share this with others as well.</p>

<p>Thanks!<br />
Happy Coding!!</p>

  </div>

  
</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <!-- <h2 class="footer-heading">Soni Pandey</h2> -->

    <div class="footer-col-wrapper">
      <!-- <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>
            
              Soni Pandey
            
            </li>
            
            <li><a href="mailto:sonipandey.71@gmail.com">sonipandey.71@gmail.com</a></li>
            
        </ul>
      </div> -->

      <div class="footer-col footer-col-1">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/pandeysoni"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">pandeysoni</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/sonipandey1"><span class="icon icon--twitter"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">sonipandey1</span></a>

          </li>
          
           
          <li>
            <a href="https://www.linkedin.com/in/pandeysoni"><span class="icon icon--linkedin"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg></span><span class="username"> pandeysoni</span></a>
          </li>
          
          
        </ul>
      </div>

      <div class="footer-col footer-col-4">
        <p>Hi, I am a Backend Developer, working on Javascript stack (Node.js | AWS Services)
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
